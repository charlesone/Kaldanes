# Kaldanes
Kaldanes are a set of families of data structures and programming methods for a different kind of data management system.

    [Valverde Computing copyright notice]

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU Lesser General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU Lesser General Public License for more details.

    You should have received a copy of the GNU Lesser General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.

    As an exception, the copyright holders of this Library grant you permission to
    (i) compile an Application with the Library, and
    (ii) distribute the Application containing code generated by the Library and    
    added to the Application during this compilation process under terms of your choice,
    provided you also meet the terms and conditions of the Application license.

There are currently three C++ source code files and three C++ header files in this collection:

1. SortBench.cpp - a benchmark application for measuring the performance (clock time) of
  various kinds of template sort methods (selection, shell, insertion, merge and quick sorts,
  but not stl sort: I could not get past the const bug: "discards qualifiers" on two string types
  when using simple arrays, and could not use the <array> type, because the program dynamically
  changes array length and template numeric veriables must be const across the compile, I believe.)
  
  Different sort methods are used against different array element types (numeric, pointer strings,
  Direct strings and Kaldane Symbiont strings (see below for descriptions of the last two.)
  Various examples of how to operate the SortBench.cpp application are commented out in the main()
  function. Multiple runs are sequentially executed. A catchall event handler is provided for
  release (performance) testing, when you will need it if something goes wrong (and if it generates
  an exception, most of the C++ runtime is the C runtime and does not generate exceptions on failure.)
  
  SortBench is currently set up to compare Direct and Kaldane Symbiont strings with std::string type
  that you get from #include <string>. Kaldane Symbiont stings are across the board faster and sometimes
  thousands of times so. std::string is quadratic for merge sort, Kaldane Symbionts are almost linear.
  
2. SortDemo.cpp - a trimmed down program to demonstrate how much faster Direct strings are than the
  std::string or <string> type for strings 64 bytes long and shorter, and to demonstrate how 
  significantly faster Kaldane Symbiont strings are than the std::string or <string> type ALL THE TIME.
  The results from running SortDemo are prineted below.
  
3. SortQATest.cpp - contains a test to drive the SortDemo-style run in a loop, checking for
  boolean operational correctness on the new types and that the sorted output is actually sorted.
  Throws exceptions if not.
  
4. Direct.h - header file for Direct string type, which are variable-length (with an upper bound)
  null-terminated byte strings that have their bytes moved as a single body when they are swapped
  as in sorting, not just moving their pointers (following the Sort Benchmark rules.) These might
  be a candidate for the Indy Sort. Direct has "value-string semantics" as Stroustrup defined for
  his String type (C++11, chapter 19.3) Direct strings are the fastest for short strings: linear
  for quick sort AND merge sort (as opposed to the type <string> which is slower for quick sort
  and quadratic for merge sort.) However, even for longer strings Direct are sub-linear in time
  complexity for string length due to cache pre-fetch (that means when you double the length of
  the strings being sorted, the time taken is quite a bit less than double.) They are designed 
  to be used  with slab allocation/deallocation on the stack, as opposed to fine-grained allocators.
  Since the allocated slab never needs to contain pointers, the slab data structure is base+offset
  and can be mmapped to a file or /dev/shm and shared locally or across  a memory fabric like Gen-Z,
  or stored and transmitted, or mmapped over an NFS: consistency considerations are an issue for
  sharing, of course (caveat participem).

5. Symbiont.h - header file for Kaldane Symbiont string, which are variable-length (with an upper
  bound) null-terminated byte strings that have their indexes and a "poor man's normalized key"
  (pmnk) moved when they are swapped, without moving their tail strings (ignoring the Sort Benchmark
  rules). Symbiont has "value-string semantics" as Stroustrup defined for his String type (C++11,
  chapter 19.3) These might be a candidate for the Indy Sort. Symbiont strings behave like Direct
  strings for short lengths (32 bytes or less, by internally equating the pmnk length with the
  string length.) This allows Symbiont strings to match Direct strings in performance for short
  strings and still have constant time complexity for any string length: they are a candidate
  for general purpose string programming with stack slab allocation/deallocation as opposed to
  the fine-grained allocators, which are necessary for pointer strings like <string>. Symbiont
  strings are quadratic in the debug build for  merge sort, and linear in the release build for
  both quick sort and merge sort, so remember to use the release build for performance analysis.
  They are designed to be used  with with slab allocation/deallocation on the stack, as opposed
  to fine-grained allocators. Since the allocated slab never needs to contain pointers, only
  array indices, the slab data structure is base+offset and can be mmapped to a file or /dev/shm
  and shared locally or across a memory fabric such as Gen-Z, or stored and transmitted, or mmapped
  over an NFS: consistency considerations are an issue for sharing, of course (caveat participem).
  
6. Sorts.h - header file containing various templated sort methods.

  The name Kaldane is an antique SciFi reference (heads move, bodies stay):
  http://www.catspawdynamics.com/images/gino_d%27achille_5-the_chessmen_of_mars.jpg
  or google image search the word "kaldane" for other images
  https://en.wikipedia.org/wiki/Kaldane

______________________________________________________________________________________

The results of running SortDemo on my Centos 7 system are below.

It's a ~$2nn refurbished 15GB HP 6300 Pro Small Format box (from Amazon.com), compiling with commands:
g++ -Wall -fexceptions -O2 -std=c++11  -c /home/charles/Projects/SortBench/SortDemo.cpp -o obj/Release/SortDemo.o
g++  -o bin/Release/SortBench obj/Release/SortDemo.o  -s  
The compiler version is "gcc version 4.8.5 20150623 (Red Hat 4.8.5-16) (GCC)"

Here are the results of the "lscpu" command on my system:

[charles@localhost ~]$ lscpu
Architecture:          x86_64
CPU op-mode(s):        32-bit, 64-bit
Byte Order:            Little Endian
CPU(s):                4
On-line CPU(s) list:   0-3
Thread(s) per core:    1
Core(s) per socket:    4
Socket(s):             1
NUMA node(s):          1
Vendor ID:             GenuineIntel
CPU family:            6
Model:                 58
Model name:            Intel(R) Core(TM) i5-3570 CPU @ 3.40GHz
Stepping:              9
CPU MHz:               1989.132
CPU max MHz:           3800.0000
CPU min MHz:           1600.0000
BogoMIPS:              6784.92
Virtualization:        VT-x
L1d cache:             32K
L1i cache:             32K
L2 cache:              256K
L3 cache:              6144K
NUMA node0 CPU(s):     0-3
Flags:                 fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx rdtscp lm constant_tsc arch_perfmon pebs bts rep_good nopl xtopology nonstop_tsc aperfmperf eagerfpu pni pclmulqdq dtes64 monitor ds_cpl vmx smx est tm2 ssse3 cx16 xtpr pdcm pcid sse4_1 sse4_2 x2apic popcnt tsc_deadline_timer aes xsave avx f16c rdrand lahf_lm epb tpr_shadow vnmi flexpriority ept vpid fsgsbase smep erms xsaveopt dtherm ida arat pln pts
[charles@localhost ~]$ 

______________________________________________________________________________________

SortDemo output (the three merge sorts for the std::string type take less than
30 minutes each, because it is quadratic on std:string):
______________________________________________________________________________________


Three different string types, identical in content and sorting logic, but not in timings.

[Remember to set the C++11 switch in the IDE or compiler!
 Remember to use release builds if you are analyzing performance, otherwise Symbionts very slow!
 Remember to set the "ulimit -s" soft and hard stack limits to unlimited, otherwise it dies!]


Quick Sort 100 10-byte strings
Direct: 12.341 microseconds, 264 swaps, 874 compares
Symbiont: 11.901 microseconds, 264 swaps, 874 compares
<string>: 18.432 microseconds, 264 swaps, 874 compares

Merge Sort 100 10-byte strings
Direct: 12.676 microseconds, 621 swaps, 538 compares
Symbiont: 11.548 microseconds, 621 swaps, 538 compares
<string>: 30.905 microseconds, 621 swaps, 538 compares

Quick Sort 100 100-byte strings
Direct: 20.427 microseconds, 271 swaps, 830 compares
Symbiont: 13.018 microseconds, 271 swaps, 830 compares
<string>: 17.019 microseconds, 271 swaps, 830 compares

Merge Sort 100 100-byte strings
Direct: 20.228 microseconds, 626 swaps, 544 compares
Symbiont: 13.059 microseconds, 626 swaps, 544 compares
<string>: 30.064 microseconds, 626 swaps, 544 compares

Quick Sort 100 1000-byte strings
Direct: 62.323 microseconds, 269 swaps, 938 compares
Symbiont: 14.72 microseconds, 269 swaps, 938 compares
<string>: 27.547 microseconds, 269 swaps, 938 compares

Merge Sort 100 1000-byte strings
Direct: 123.281 microseconds, 612 swaps, 536 comparesDownton Abbey
Symbiont: 14.822 microseconds, 612 swaps, 536 compares
<string>: 33.879 microseconds, 612 swaps, 536 compares

Quick Sort 10000 10-byte strings
Direct: 2015.8 microseconds, 42517 swaps, 175202 compares                                             
Symbiont: 1881.92 microseconds, 42517 swaps, 175202 compares                                          
<string>: 3507.83 microseconds, 42517 swaps, 175202 compares                                          
                                                                                                      
Merge Sort 10000 10-byte strings                                                                      
Direct: 2312.41 microseconds, 128170 swaps, 120587 compares                                           
Symbiont: 1947.78 microseconds, 128170 swaps, 120587 compares                                         
<string>: 89182.9 microseconds, 128170 swaps, 120587 compares                                         
                                                                                                      
Quick Sort 10000 100-byte strings                                                                     
Direct: 3113.39 microseconds, 42506 swaps, 172985 compares                                            
Symbiont: 3049.68 microseconds, 42506 swaps, 172985 compares                                          
<string>: 3375.56 microseconds, 42506 swaps, 172985 compares                                          
                                                                                                      
Merge Sort 10000 100-byte strings                                                                     
Direct: 3651.84 microseconds, 128150 swaps, 120468 compares                                           
Symbiont: 3029.47 microseconds, 128150 swaps, 120468 compares                                         
<string>: 90006 microseconds, 128150 swaps, 120468 compares                                           
                                                                                                      
Quick Sort 10000 1000-byte strings                                                                    
Direct: 10762.2 microseconds, 41579 swaps, 199974 compares                                            
Symbiont: 3060.71 microseconds, 41579 swaps, 199974 compares                                          
<string>: 5189.03 microseconds, 41579 swaps, 199974 compares                                          
                                                                                                      
Merge Sort 10000 1000-byte strings                                                                    
Direct: 26876.2 microseconds, 128255 swaps, 120407 compares                                           
Symbiont: 4188.41 microseconds, 128255 swaps, 120407 compares                                         
<string>: 89215 microseconds, 128255 swaps, 120407 compares                                           
                                                                                                      
Quick Sort 1000000 10-byte strings                                                                    
Direct: 280520 microseconds, 5790793 swaps, 27307387 compares                                         
Symbiont: 268434 microseconds, 5790793 swaps, 27307387 compares                                       
<string>: 658038 microseconds, 5790793 swaps, 27307387 compares                                       
                                                                                                      
Merge Sort 1000000 10-byte strings                                                                    
Direct: 330470 microseconds, 19344095 swaps, 18672860 compares                                        
Symbiont: 285327 microseconds, 19344095 swaps, 18672860 compares                                      
<string>: 1.78344e+09 microseconds, 19344095 swaps, 18672860 compares                                 
                                                                                                      
Quick Sort 1000000 100-byte strings                                                                   
Direct: 503592 microseconds, 5766447 swaps, 27738756 compares                                         
Symbiont: 730720 microseconds, 5766447 swaps, 27738756 compares                                       
<string>: 733012 microseconds, 5766447 swaps, 27738756 compares                                       
                                                                                                      
Merge Sort 1000000 100-byte strings                                                                   
Direct: 753156 microseconds, 19345917 swaps, 18674260 compares                                        
Symbiont: 873545 microseconds, 19345917 swaps, 18674260 compares                                      
<string>: 1.83165e+09 microseconds, 19345917 swaps, 18674260 compares                                 
                                                                                                      
Quick Sort 1000000 1000-byte strings                                                                  
Direct: 1.87837e+06 microseconds, 5785155 swaps, 26678210 compares                                    
Symbiont: 722463 microseconds, 5785155 swaps, 26678210 compares                                       
<string>: 980021 microseconds, 5785155 swaps, 26678210 compares                                       
                                                                                                      
Merge Sort 1000000 1000-byte strings                                                                  
Direct: 5.72648e+06 microseconds, 19345317 swaps, 18674369 compares                                   
Symbiont: 1.01169e+06 microseconds, 19345317 swaps, 18674369 compares                                 
<string>: 1.74197e+09 microseconds, 19345317 swaps, 18674369 compares                                 
                                                                                                      
Process returned 0 (0x0)   execution time : 5391.581 s                                                
Press ENTER to continue.                                                                              
______________________________________________________________________________________

